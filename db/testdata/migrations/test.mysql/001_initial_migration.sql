-- +migrate Up
-- Initial migration

DROP TABLE IF EXISTS ARTICLES;
DROP TABLE IF EXISTS userinfos;
DROP TABLE IF EXISTS users;


CREATE TABLE users(
    id INTEGER PRIMARY KEY AUTO_INCREMENT ,
    name VARCHAR(255) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    created DATETIME NOT NULL DEFAULT NOW(), 
    updated DATETIME NOT NULL DEFAULT NOW(),
    userinfo_id INTEGER NOT NULL,
	password_digest TEXT NOT NULL
);

CREATE TABLE ARTICLES (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    created DATETIME NOT NULL DEFAULT NOW(), 
    updated DATETIME NOT NULL DEFAULT NOW(),
	author_id INTEGER REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE userinfos(
	id INTEGER PRIMARY KEY AUTO_INCREMENT,
	nicename VARCHAR(50) NOT NULL,
	url VARCHAR(100) NOT NULL,
	registered DATETIME NOT NULL DEFAULT NOW(),
	activation_key VARCHAR(50) NOT NULL,
	status INTEGER NOT NULL,
	display_name VARCHAR(250) NOT NULL,
	user_id INTEGER NOT NULL REFERENCES user(id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX USERS_EMAIL ON users(email);
CREATE UNIQUE INDEX USERS_NAME on users(name);


-- +migrate Down
-- remove articles
DROP TABLE ARTICLES;
DROP TABLE userinfos;
DROP TABLE users;
